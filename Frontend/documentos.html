<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Documentos</title>

    <link href="CSS/tema.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="javascript/mainApp.js" ></script>
    <script type="text/javascript" src="javascript/jquery-3.1.1.min.js" ></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script>
        function AbrirDialogo(){
            LoadDialog('#novoModelo', '../Frontend/views/novoModelo.html');
            $('#novoModelo').modal('show');
        }
        function FecharDialogo(){
            ListarItems();
            $('#novoModelo').modal('hide');
        }

        function InserirNovo(){
            var id = 0;
            var targetUrl = "../Backend/_modeloDocumento/store.php";
            var callParameters = {'nome': $('input[name=nome]').val(), 'descricao': $('input[name=descricao]').val()};
            $.ajax({ type: 'POST', url: targetUrl, data: callParameters, success: function(response) { id = response; }, async: false });
        }
        function ListarItems(){
            var targetUrl = "../Backend/_modeloDocumento/retrieve.php";
            var callParameters = {'reg':''}; // Parâmetro vazio, retorna todos os registros
            $.ajax({ type: 'POST', url: targetUrl, data: callParameters, success: function(response) { ParseResponse(response); }, async: false });
        }
        function ExcluirItem(id){
            var targetUrl = "../Backend/_modeloDocumento/delete.php";
            var callParameters = {'reg[]':id};  // TODO: Exclusão multipla, selecionando vários items
            $.ajax({ type: 'POST', url: targetUrl, data: callParameters, success: function(response) { alert(response); }, async: false });
        }
        function EditarItem(id){
            LoadView('#editarModelo', '../Frontend/views/editarModelo.html');
            LoadScript('javascript/editarModelo.js', function(){ SetRecordId(id); LoadRecord(); ListarCampos(); } );
            SetDialogParams('#novoCampo', '../Frontend/views/novoCampo.html');
        }
        function ParseResponse(response){
            var lista = document.getElementById("lista");
            lista.innerHTML = '<tr class="info"><td>Nome</td><td>Descrição</td><td>Ações</td></tr>'; // Limpa a lista antes de recarregar

            var itemList = JSON.parse(response);
            for(var item in itemList) {
                DisplayItem(itemList[item]);
            }
        }
        function DisplayItem(modeloDocumento){
            var row = document.createElement('tr');
            var col1 = document.createElement('td');
            col1.innerText = modeloDocumento.nome;
            var col2 = document.createElement('td');
            col2.innerText = modeloDocumento.descricao;
            var col3 = document.createElement('td');
            var editClick = 'EditarItem(' + modeloDocumento.id + ');';
            var deleteClick = 'ExcluirItem(' + modeloDocumento.id + '); ListarItems();';
            col3.innerHTML = '&nbsp; <img src="images/edit.png" onclick="' + editClick + '" /> &nbsp; <img src="images/dump.png" onclick="' + deleteClick + '" />';
            row.appendChild(col1);
            row.appendChild(col2);
            row.appendChild(col3);
            lista.appendChild(row);
        }
    </script>
</head>
<body>

    <br/>
    <br/>

    <ul class="nav nav-tabs" role="tablist">
        <li><a href="#">Documentos indexados</a></li>
        <li><a href="#">Documentos não indexados</a></li>
        <li class="active"><a href="modeloDocumento.html">Modelos de documento</a></li>        
    </ul>

    <div id="navigationTabs"></div>
    <div id="modalDialog"></div>
    <div id="container"></div>
    <br/>

    <script type="text/javascript" >
        $(document).ready(function() {
            LoadView('#listarModelos', '../Frontend/views/listarModelos.html');
            ListarItems();
        });
    </script>

</body>
</html>
