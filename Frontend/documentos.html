<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Documentos</title>

    <link href="CSS/tema.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script>
        function LoadView(viewName, viewURL){
            $('#container').hide();
            // Busca a view no servidor através de uma requisição sincrona
            $.ajax({ url: viewURL, context: this, async: false, success: function(response) {
                    var container = document.getElementById("container");
                    if ( $(viewName).length == 0) {  // Verifica se a view já foi carregada, evita duplicações
                        container.innerHTML = response;
                    }
                }
            });
            $('#container').show();
        }
        function LoadDialog(dialogName, dialogURL){
            // Busca a view no servidor através de uma requisição sincrona
            $.ajax({ url: dialogURL, context: this, async: false, success: function(response) {
                    var modalDialog = document.getElementById("modalDialog");
                    if ( $(dialogName).length == 0) {  // Verifica se a view já foi carregada, evita duplicações
                        modalDialog.innerHTML = response;
                    }
                }
            });
        }

        function AbrirDialogo(){
            LoadDialog('#novoCampo', '../Frontend/views/novoCampo.html');
            $('#novoCampo').modal('show');
        }
        function FecharDialogo(){
            ListarItems();
            $('#novoCampo').modal('hide');
        }

        function InserirNovo(){
            var id = 0;
            var targetUrl = "../Backend/_campoDocumento/store.php";
            var callParameters = {'modeloDocumento': $('input[name=modeloDocumento]').val(),'nome': $('input[name=nome]').val(), 'tipo': $('select[name=tipo]').val()};
            $.ajax({ type: 'POST', url: targetUrl, data: callParameters, success: function(response) { id = response; }, async: false });
        }
        function ListarItems(){
            var targetUrl = "../Backend/_campoDocumento/retrieve.php";
            var callParameters = {'reg':''}; // Parâmetro vazio, retorna todos os registros
            $.ajax({ type: 'POST', url: targetUrl, data: callParameters, success: function(response) { ParseResponse(response); }, async: false });
        }
        function ExcluirItem(id){
            var targetUrl = "../Backend/_campoDocumento/delete.php";
            var callParameters = {'reg[]':id};  // TODO: Exclusão multipla, selecionando vários items
            $.ajax({ type: 'POST', url: targetUrl, data: callParameters, success: function(response) { alert(response); }, async: false });
        }
        function ParseResponse(response){
            var lista = document.getElementById("lista");
            lista.innerHTML = '<tr class="info"> <td>Nome do campo</td><td>Formato</td><td>Ações</td> </tr>'; // Limpa a lista antes de recarregar

            var itemList = JSON.parse(response);
            for(var item in itemList) {
                DisplayItem(itemList[item]);
            }
        }
        function DisplayItem(campoDocumento){
            var row = document.createElement('tr');
            var col1 = document.createElement('td');
            col1.innerText = campoDocumento.nome;
            var col2= document.createElement('td');
            col2.innerText = campoDocumento.tipo;
            var col3 = document.createElement('td');
            // var editClick = 'EditarItem(' + campoDocumento.id + ');';
            var deleteClick = 'ExcluirItem(' + campoDocumento.id + '); ListarItems();';
            col3.innerHTML = '&nbsp; <img src="images/edit.png" /> &nbsp; <img src="images/dump.png" onclick="' + deleteClick + '" />';
            row.appendChild(col1);
            row.appendChild(col2);
            row.appendChild(col3);
            lista.appendChild(row);
        }
    </script>
</head>
<body>

<br/>
<br/>

<ul class="nav nav-tabs" role="tablist">
    <li><a href="#">Documentos indexados</a></li>
    <li><a href="#">Documentos não indexados</a></li>
    <li class="active"><a href="modeloDocumento.html">Modelos de documento</a></li>        
</ul>

<div id="modalDialog"></div>
<div id="container"></div>
<br/>

<script type="text/javascript" >
    $(document).ready(function() {
        LoadView('#editarModelo', '../Frontend/views/editarModelo.html');
        ListarItems();
    });
</script>

</body>
</html>
